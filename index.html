<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>365DF MLM (CoreV4) - User DApp</title>

  <link rel="stylesheet" href="style.css" />

  <!-- Ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <script src="config.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h1>üå§Ô∏è 365DF MLM (CoreV4)</h1>
      <div class="seg">
        <button class="btn primary" id="btnConnect">Connect Wallet</button>
        <button class="btn" id="btnRefresh">Refresh</button>
      </div>
    </div>

    <div class="card">
      <div class="row"><div class="label">Network</div><div class="mono" id="netText">-</div></div>
      <div class="row"><div class="label">Wallet</div><div class="mono" id="walletAddr">-</div></div>
      <div class="row"><div class="label">CoreV4</div><div class="mono" id="coreAddr">-</div></div>
      <div class="row"><div class="label">VaultV5</div><div class="mono" id="vaultAddr">-</div></div>
      <div class="row"><div class="label">BinaryV4</div><div class="mono" id="binaryAddr">-</div></div>
      <div class="row"><div class="label">Staking365V4</div><div class="mono" id="stakingAddr">-</div></div>
      <div class="row"><div class="label">USDT</div><div class="mono" id="usdtAddr">-</div></div>
      <div class="row"><div class="label">365DF</div><div class="mono" id="dfAddr">-</div></div>
      <div class="small muted hint">
        * Best experience: open in Bitget/MetaMask DApp Browser.
      </div>
    </div>

    <div class="card">
      <h2>üîó Referral Links</h2>
      <div class="grid2">
        <div class="box">
          <div class="label">Left Link (L)</div>
          <div class="mono small" id="leftLink" style="word-break:break-all">-</div>
          <div class="actions">
            <button class="btn" id="btnCopyLeft">Copy Left</button>
          </div>
        </div>

        <div class="box">
          <div class="label">Right Link (R)</div>
          <div class="mono small" id="rightLink" style="word-break:break-all">-</div>
          <div class="actions">
            <button class="btn" id="btnCopyRight">Copy Right</button>
          </div>
        </div>
      </div>

      <div class="small muted hint">
        Opening the link will auto-fill sponsor + side via query: <span class="mono">?ref=...&side=L/R</span>
      </div>
    </div>

    <div class="card">
      <h2>üßæ Buy / Upgrade Package</h2>

      <div class="grid2">
        <div class="box">
          <div class="label">Sponsor (optional)</div>
          <input class="inp mono" id="inpSponsor" placeholder="0x... (empty = company fallback)" />
          <div class="small muted hint">* Empty sponsor will fallback to company wallet in Core (if supported).</div>
        </div>

        <div class="box">
          <div class="label">Placement Side</div>
          <div class="actions">
            <button class="btn primary" id="btnSideL">Left</button>
            <button class="btn" id="btnSideR">Right</button>
          </div>
          <div class="small muted hint">* If side taken, tx may revert with SIDE_TAKEN.</div>
        </div>
      </div>

      <div class="box" style="margin-top:12px">
        <div class="label">Select Package</div>

        <div class="pkgWrap" style="margin-top:10px">
          <button class="pkg" data-pkg="1" type="button">
            <div class="t">Small</div>
            <div class="muted">100 USDT</div>
            <div class="small muted">DF principal: 365</div>
          </button>

          <button class="pkg" data-pkg="2" type="button">
            <div class="t">Medium</div>
            <div class="muted">1,000 USDT</div>
            <div class="small muted">DF principal: 3,650</div>
          </button>

          <button class="pkg" data-pkg="3" type="button">
            <div class="t">Large</div>
            <div class="muted">10,000 USDT</div>
            <div class="small muted">DF principal: 36,500</div>
          </button>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="label">Selected</div>
          <div id="selectedPkg">-</div>
        </div>

        <div class="actions">
          <button class="btn" id="btnApprove">Approve USDT</button>
          <button class="btn primary" id="btnBuy">Approve + Buy/Upgrade</button>
        </div>

        <div class="small muted hint">
          * ‚ÄúApprove + Buy/Upgrade‚Äù will approve first, then buy immediately.
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üìä My Dashboard</h2>

      <div class="grid2">
        <div class="box"><div class="label">My Sponsor</div><div class="mono" id="mySponsor">-</div></div>
        <div class="box"><div class="label">My Side</div><div class="mono" id="mySide">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">My Package</div><div id="myPkg">-</div></div>
        <div class="box"><div class="label">My Rank</div><div id="myRank">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Left Child</div><div class="mono" id="leftChild">-</div></div>
        <div class="box"><div class="label">Right Child</div><div class="mono" id="rightChild">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Binary Volume (L)</div><div class="mono" id="volL">-</div></div>
        <div class="box"><div class="label">Binary Volume (R)</div><div class="mono" id="volR">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Binary Paid (P)</div><div class="mono" id="volP">-</div></div>
        <div class="box"><div class="label">Pending DF Reward</div><div class="mono" id="pendingStake">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Stake Start</div><div class="mono" id="stakeStart">-</div></div>
        <div class="box"><div class="label">Stake End</div><div class="mono" id="stakeEnd">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Stake Countdown</div><div class="mono" id="stakeCountdown">-</div></div>
        <div class="box"><div class="label">Stake Status</div><div id="stakeStatus">-</div></div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box"><div class="label">Vault Claimable USDT</div><div class="mono" id="claimUSDT">-</div></div>
        <div class="box"><div class="label">Vault Claimable DF</div><div class="mono" id="claimDF">-</div></div>
      </div>

      <!-- ‚úÖ NEW: CAP + VAULT COUNTDOWN (D:H:M:S) -->
      <div class="grid2" style="margin-top:10px">
        <div class="box">
          <div class="label">Commission Cap</div>
          <div class="mono" id="capLimit">-</div>
          <div class="small muted hint">Cap by package: Small 365 / Medium 3650 / Large 36500 (USDT)</div>
        </div>
        <div class="box">
          <div class="label">Cap Remaining</div>
          <div class="mono" id="capRemain">-</div>
          <div class="small muted hint">Based on Vault earns: claimed + unlocked + locked</div>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box">
          <div class="label">Total Earned (Vault-based)</div>
          <div class="mono" id="earnedTotal">-</div>
          <div class="small muted hint">USDT: claimed+unlocked+locked</div>
        </div>
        <div class="box">
          <div class="label">Vault Lock End</div>
          <div class="mono" id="vaultEnd">-</div>
          <div class="small muted hint">If expired: will show Expired ‚úÖ</div>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="box">
          <div class="label">Vault Countdown (D:H:M:S)</div>
          <div class="mono" id="vaultCountdown">-</div>
        </div>
        <div class="box">
          <div class="label">Vault Status</div>
          <div class="mono" id="vaultStatus">-</div>
        </div>
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn" id="btnClaimVault">Claim Vault (USDT+DF)</button>
        <button class="btn primary" id="btnClaimStake">Claim Stake (DF)</button>
      </div>

      <div class="small muted hint">
        * Claim Vault = claim vault credits (commissions, etc.) <br/>
        * Claim Stake = claim DF principal+reward after 365 days
      </div>
    </div>

    <div class="card">
      <h2>üß† Status</h2>
      <div class="status" id="status">Ready. Please connect wallet.</div>
      <div class="foot small muted">
        * For mobile, open via Bitget/MetaMask DApp Browser.
      </div>
    </div>
  </div>

  <div id="toast" class="toast">-</div>
  <script src="app.js"></script>
</body>
</html>
